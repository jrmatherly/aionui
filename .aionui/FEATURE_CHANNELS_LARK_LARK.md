# é£ä¹¦ (Lark) æ¥å…¥æ–¹æ¡ˆ

> æœ¬æ–‡æ¡£è®°å½•é£ä¹¦å¹³å°æ¥å…¥çš„å®Œæ•´å¼€å‘æ–¹æ¡ˆï¼ŒåŸºäºç°æœ‰ Telegram æ’ä»¶æ¶æ„è¿›è¡Œæ‰©å±•ã€‚

---

## 1. åŠŸèƒ½æ¦‚è¿°

### 1.1 åŸºæœ¬ä¿¡æ¯

- **åŠŸèƒ½åç§°**: é£ä¹¦æœºå™¨äººæ¥å…¥
- **æ‰€å±æ¨¡å—**: Channel Plugin å±‚
- **æ¶‰åŠè¿›ç¨‹**: ä¸»è¿›ç¨‹ (process)
- **è¿è¡Œç¯å¢ƒ**: GUI æ¨¡å¼ï¼ˆAionUi è¿è¡Œä¸­ï¼‰
- **ä¾èµ–**: ç°æœ‰ Channel æ¶æ„ã€PairingServiceã€SessionManager

### 1.2 åŠŸèƒ½æè¿°

1. å¤ç”¨ç°æœ‰ Channel æ’ä»¶æ¶æ„ï¼Œæ–°å¢é£ä¹¦å¹³å°æ”¯æŒ
2. ç”¨æˆ·å¯é€šè¿‡é£ä¹¦æœºå™¨äººä¸ AionUi è¿›è¡Œå¯¹è¯
3. æ”¯æŒ Geminiã€Claudeã€Codex ç­‰å¤š Agent åˆ‡æ¢
4. ä¸ Telegram åŠŸèƒ½å®Œå…¨å¯¹é½

### 1.3 ç”¨æˆ·åœºæ™¯

```
è§¦å‘: ç”¨æˆ·åœ¨é£ä¹¦ä¸­ @AionBot æˆ–ç§èŠå‘é€æ¶ˆæ¯
è¿‡ç¨‹: é£ä¹¦æœºå™¨äººæ¥æ”¶æ¶ˆæ¯ â†’ è½¬å‘ç»™ Aion Agent â†’ LLM å¤„ç†
ç»“æœ: å¤„ç†å®Œæˆåé€šè¿‡é£ä¹¦æ¶ˆæ¯å¡ç‰‡æ¨é€ç»“æœç»™ç”¨æˆ·
```

### 1.4 å‚è€ƒèµ„æº

- **é£ä¹¦å¼€æ”¾å¹³å°**: https://open.feishu.cn/
- **Node SDK**: https://github.com/larksuite/node-sdk
- **ç°æœ‰å®ç°**: `src/channels/plugins/telegram/`

---

## 2. æŠ€æœ¯é€‰å‹

### 2.1 å¹³å°å¯¹æ¯”

| é¡¹ç›®         | Telegram                         | é£ä¹¦                       |
| ------------ | -------------------------------- | -------------------------- |
| **Bot åº“**   | grammY                           | @larksuiteoapi/node-sdk    |
| **è¿è¡Œæ¨¡å¼** | Polling / Webhook                | WebSocket é•¿è¿æ¥ / Webhook |
| **è®¤è¯æ–¹å¼** | Bot Token                        | App ID + App Secret        |
| **äº¤äº’ç»„ä»¶** | Inline Keyboard + Reply Keyboard | æ¶ˆæ¯å¡ç‰‡ (Message Card)    |
| **æ¶ˆæ¯æ ¼å¼** | Markdown / HTML                  | å¯Œæ–‡æœ¬ / æ¶ˆæ¯å¡ç‰‡ JSON     |
| **æµå¼æ›´æ–°** | editMessageText                  | PATCH /im/v1/messages/:id  |

### 2.2 æŠ€æœ¯é€‰æ‹©

| é¡¹ç›®     | é€‰æ‹©                    | è¯´æ˜                       |
| -------- | ----------------------- | -------------------------- |
| SDK      | @larksuiteoapi/node-sdk | å®˜æ–¹ Node.js SDK           |
| è¿è¡Œæ¨¡å¼ | WebSocket (ä¼˜å…ˆ)        | æ— éœ€å…¬ç½‘åœ°å€ï¼Œé€‚åˆæ¡Œé¢åº”ç”¨ |
| æ¶ˆæ¯æ ¼å¼ | æ¶ˆæ¯å¡ç‰‡                | æ”¯æŒå¯Œæ–‡æœ¬å’Œäº¤äº’æŒ‰é’®       |

---

## 3. é…ç½®æµç¨‹

### 3.1 é£ä¹¦åº”ç”¨åˆ›å»º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: åˆ›å»ºåº”ç”¨                                            â”‚
â”‚   é£ä¹¦å¼€æ”¾å¹³å° â†’ åˆ›å»ºä¼ä¸šè‡ªå»ºåº”ç”¨ â†’ è·å– App ID/Secret      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Step 2: å¼€å¯æœºå™¨äººèƒ½åŠ›                                      â”‚
â”‚   åº”ç”¨èƒ½åŠ› â†’ æœºå™¨äºº â†’ å¼€å¯                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Step 3: é…ç½®æƒé™                                            â”‚
â”‚   æƒé™ç®¡ç† â†’ æ·»åŠ ä»¥ä¸‹æƒé™:                                  â”‚
â”‚   â€¢ im:message (è·å–ä¸å‘é€å•èŠã€ç¾¤ç»„æ¶ˆæ¯)                   â”‚
â”‚   â€¢ im:message.group_at_msg (æ¥æ”¶ç¾¤èŠ@æœºå™¨äººæ¶ˆæ¯)           â”‚
â”‚   â€¢ im:chat (è·å–ç¾¤ç»„ä¿¡æ¯)                                  â”‚
â”‚   â€¢ contact:user.id:readonly (è·å–ç”¨æˆ· ID)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Step 4: å‘å¸ƒåº”ç”¨                                            â”‚
â”‚   ç‰ˆæœ¬ç®¡ç†ä¸å‘å¸ƒ â†’ åˆ›å»ºç‰ˆæœ¬ â†’ ç”³è¯·å‘å¸ƒ                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Step 5: é…ç½® AionUi                                         â”‚
â”‚   è®¾ç½® â†’ Channels â†’ é£ä¹¦ â†’ ç²˜è´´ App ID/Secret â†’ å¯åŠ¨       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 é…ç½®é¡¹

| é…ç½®é¡¹      | ç±»å‹                 | è¯´æ˜                | å¿…å¡« |
| ----------- | -------------------- | ------------------- | :--: |
| App ID      | string               | é£ä¹¦åº”ç”¨ ID         |  âœ…  |
| App Secret  | string               | é£ä¹¦åº”ç”¨å¯†é’¥        |  âœ…  |
| è¿è¡Œæ¨¡å¼    | websocket / webhook  | äº‹ä»¶æ¥æ”¶æ¨¡å¼        |  âœ…  |
| Webhook URL | string               | ä»… webhook æ¨¡å¼éœ€è¦ |  âŒ  |
| é…å¯¹æ¨¡å¼    | boolean              | æ˜¯å¦éœ€è¦é…å¯¹ç æˆæƒ  |  âœ…  |
| é€Ÿç‡é™åˆ¶    | number               | æ¯åˆ†é’Ÿæœ€å¤§æ¶ˆæ¯æ•°    |  âŒ  |
| é»˜è®¤ Agent  | gemini / acp / codex | é»˜è®¤ä½¿ç”¨çš„ Agent    |  âœ…  |

---

## 4. é…å¯¹å®‰å…¨æœºåˆ¶

### 4.1 æµç¨‹è®¾è®¡ï¼ˆä¸ Telegram ä¸€è‡´ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â‘  ç”¨æˆ·åœ¨é£ä¹¦ä¸­å‘èµ·                                         â”‚
â”‚    ç”¨æˆ· â†’ @AionBot: ä»»æ„æ¶ˆæ¯                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â‘¡ Bot è¿”å›é…å¯¹è¯·æ±‚ï¼ˆæ¶ˆæ¯å¡ç‰‡ï¼‰                              â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚    â”‚ ğŸ‘‹ æ¬¢è¿ä½¿ç”¨ Aion åŠ©æ‰‹ï¼                â”‚              â”‚
â”‚    â”‚                                        â”‚              â”‚
â”‚    â”‚ ğŸ”‘ é…å¯¹ç : ABC123                      â”‚              â”‚
â”‚    â”‚ è¯·åœ¨ AionUi ä¸­æ‰¹å‡†æ­¤é…å¯¹               â”‚              â”‚
â”‚    â”‚                                        â”‚              â”‚
â”‚    â”‚ [ğŸ“– ä½¿ç”¨æŒ‡å—]  [ğŸ”„ åˆ·æ–°çŠ¶æ€]           â”‚              â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â‘¢ AionUi æ˜¾ç¤ºå¾…æ‰¹å‡†è¯·æ±‚                                    â”‚
â”‚    è®¾ç½®é¡µé¢å±•ç¤º: ç”¨æˆ·åã€é…å¯¹ç ã€è¯·æ±‚æ—¶é—´ã€[æ‰¹å‡†]/[æ‹’ç»]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â‘£ ç”¨æˆ·åœ¨ AionUi ç‚¹å‡» [æ‰¹å‡†]                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â‘¤ Bot æ¨é€é…å¯¹æˆåŠŸæ¶ˆæ¯                                     â”‚
â”‚    Bot â†’ ç”¨æˆ·: "âœ… é…å¯¹æˆåŠŸï¼ç°åœ¨å¯ä»¥å¼€å§‹å¯¹è¯äº†"           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å®‰å…¨æªæ–½

| æœºåˆ¶         | è¯´æ˜                           |
| ------------ | ------------------------------ |
| é…å¯¹ç è®¤è¯   | 6ä½éšæœºç ï¼Œ10åˆ†é’Ÿæœ‰æ•ˆ          |
| æœ¬åœ°æ‰¹å‡†     | å¿…é¡»åœ¨ AionUi ä¸­æ‰¹å‡†ï¼Œéé£ä¹¦ä¸­ |
| ç”¨æˆ·ç™½åå•   | ä»…æˆæƒç”¨æˆ·å¯ä½¿ç”¨               |
| é€Ÿç‡é™åˆ¶     | é˜²æ­¢æ»¥ç”¨                       |
| å‡­è¯åŠ å¯†å­˜å‚¨ | ä½¿ç”¨åŠ å¯†å­˜å‚¨ App Secret        |

---

## 5. æ¶ˆæ¯è½¬æ¢è§„åˆ™

### 5.1 å…¥ç«™è½¬æ¢ï¼ˆé£ä¹¦ â†’ ç»Ÿä¸€æ ¼å¼ï¼‰

| é£ä¹¦äº‹ä»¶ç±»å‹                    | ç»Ÿä¸€æ¶ˆæ¯ content.type |
| ------------------------------- | --------------------- |
| `im.message.receive_v1` (text)  | `text`                |
| `im.message.receive_v1` (image) | `image`               |
| `im.message.receive_v1` (file)  | `file`                |
| `im.message.receive_v1` (audio) | `audio`               |
| `card.action.trigger`           | `action`              |

### 5.2 å‡ºç«™è½¬æ¢ï¼ˆç»Ÿä¸€æ ¼å¼ â†’ é£ä¹¦ï¼‰

| ç»Ÿä¸€æ¶ˆæ¯ type | é£ä¹¦ API                  | content_type |
| ------------- | ------------------------- | ------------ |
| `text`        | POST /im/v1/messages      | text         |
| `image`       | POST /im/v1/messages      | image        |
| `buttons`     | POST /im/v1/messages      | interactive  |
| æµå¼æ›´æ–°      | PATCH /im/v1/messages/:id | -            |

### 5.3 æ¶ˆæ¯å¡ç‰‡ç»“æ„

```json
{
  "config": {
    "wide_screen_mode": true
  },
  "header": {
    "title": {
      "tag": "plain_text",
      "content": "Aion åŠ©æ‰‹"
    }
  },
  "elements": [
    {
      "tag": "markdown",
      "content": "æ¶ˆæ¯å†…å®¹..."
    },
    {
      "tag": "action",
      "actions": [
        {
          "tag": "button",
          "text": { "tag": "plain_text", "content": "ğŸ†• æ–°å¯¹è¯" },
          "type": "primary",
          "value": { "action": "session.new" }
        }
      ]
    }
  ]
}
```

---

## 6. äº¤äº’è®¾è®¡

### 6.1 ç»„ä»¶æ˜ å°„

| åœºæ™¯             | Telegram             | é£ä¹¦               |
| ---------------- | -------------------- | ------------------ |
| **å¸¸é©»å¿«æ·æ“ä½œ** | Reply Keyboard       | æ¶ˆæ¯å¡ç‰‡åº•éƒ¨æŒ‰é’®ç»„ |
| **æ¶ˆæ¯æ“ä½œæŒ‰é’®** | Inline Keyboard      | æ¶ˆæ¯å¡ç‰‡äº¤äº’æŒ‰é’®   |
| **é…å¯¹è¯·æ±‚**     | æ–‡æœ¬ + æŒ‰é’®          | æ¶ˆæ¯å¡ç‰‡           |
| **AI å›å¤**      | Markdown + æŒ‰é’®      | å¯Œæ–‡æœ¬/å¡ç‰‡ + æŒ‰é’® |
| **è®¾ç½®èœå•**     | å¤šçº§ Inline Keyboard | æ¶ˆæ¯å¡ç‰‡           |

### 6.2 äº¤äº’åœºæ™¯

**åœºæ™¯ 1: é…å¯¹æˆåŠŸåçš„ä¸»èœå•**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ¶ˆæ¯å¡ç‰‡ (Message Card)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ… é…å¯¹æˆåŠŸï¼ç°åœ¨å¯ä»¥å¼€å§‹å¯¹è¯äº†                            â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [ğŸ†• æ–°å¯¹è¯]  [ğŸ”„ Agent]  [ğŸ“Š çŠ¶æ€]  [â“ å¸®åŠ©]       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åœºæ™¯ 2: AI å›å¤å¸¦æ“ä½œæŒ‰é’®**

````
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ¶ˆæ¯å¡ç‰‡ (Message Card)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¿™æ˜¯ä¸€ä¸ªå¿«é€Ÿæ’åºçš„å®ç°ï¼š                                   â”‚
â”‚                                                             â”‚
â”‚  ```python                                                  â”‚
â”‚  def quicksort(arr):                                        â”‚
â”‚      if len(arr) <= 1:                                      â”‚
â”‚          return arr                                         â”‚
â”‚      ...                                                    â”‚
â”‚  ```                                                        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [ğŸ“‹ å¤åˆ¶]  [ğŸ”„ é‡æ–°ç”Ÿæˆ]  [ğŸ’¬ ç»§ç»­]                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
````

**åœºæ™¯ 3: Agent åˆ‡æ¢**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ¶ˆæ¯å¡ç‰‡ (Message Card)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”„ åˆ‡æ¢ Agent                                              â”‚
â”‚                                                             â”‚
â”‚  é€‰æ‹©ä¸€ä¸ª AI Agentï¼š                                        â”‚
â”‚  å½“å‰: ğŸ¤– Gemini                                            â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [âœ“ ğŸ¤– Gemini]  [ğŸ§  Claude]  [âš¡ Codex]              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. æ–‡ä»¶ç»“æ„

```
src/channels/
â”œâ”€â”€ plugins/
â”‚   â”œâ”€â”€ telegram/              # ç°æœ‰ Telegram æ’ä»¶
â”‚   â”‚   â”œâ”€â”€ TelegramPlugin.ts
â”‚   â”‚   â”œâ”€â”€ TelegramAdapter.ts
â”‚   â”‚   â”œâ”€â”€ TelegramKeyboards.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â””â”€â”€ lark/                  # æ–°å¢é£ä¹¦æ’ä»¶
â”‚       â”œâ”€â”€ LarkPlugin.ts      # é£ä¹¦æ’ä»¶ä¸»ç±»
â”‚       â”œâ”€â”€ LarkAdapter.ts     # æ¶ˆæ¯æ ¼å¼è½¬æ¢
â”‚       â”œâ”€â”€ LarkCards.ts       # æ¶ˆæ¯å¡ç‰‡æ¨¡æ¿
â”‚       â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ types.ts                   # éœ€è¦æ–°å¢ 'lark' åˆ° PluginType
â””â”€â”€ ...
```

---

## 8. æ¥å£è®¾è®¡

### 8.1 LarkPlugin ç±»

```typescript
class LarkPlugin extends BasePlugin {
  // ç”Ÿå‘½å‘¨æœŸ
  async initialize(config: LarkPluginConfig): Promise<void>;
  async start(): Promise<void>;
  async stop(): Promise<void>;

  // æ¶ˆæ¯å¤„ç†
  async sendMessage(chatId: string, message: IUnifiedOutgoingMessage): Promise<string>;
  async editMessage(chatId: string, messageId: string, message: IUnifiedOutgoingMessage): Promise<void>;

  // äº‹ä»¶å¤„ç†
  private handleMessageEvent(event: LarkMessageEvent): void;
  private handleCardAction(action: LarkCardAction): void;

  // Token ç®¡ç†
  private async refreshAccessToken(): Promise<void>;
}
```

### 8.2 é…ç½®æ¥å£

```typescript
interface LarkPluginConfig {
  appId: string;
  appSecret: string;
  mode: 'websocket' | 'webhook';
  webhookUrl?: string;
  encryptKey?: string; // äº‹ä»¶åŠ å¯†å¯†é’¥
  verificationToken?: string; // äº‹ä»¶éªŒè¯ä»¤ç‰Œ
}
```

---

## 9. é£ä¹¦ç‰¹æœ‰æ³¨æ„äº‹é¡¹

| é¡¹ç›®             | è¯´æ˜                                       |
| ---------------- | ------------------------------------------ |
| **åº”ç”¨ç±»å‹**     | å»ºè®®ä½¿ç”¨ä¼ä¸šè‡ªå»ºåº”ç”¨ï¼Œä¸ªäººå¼€å‘è€…æœ‰åŠŸèƒ½é™åˆ¶ |
| **æƒé™å®¡æ ¸**     | éƒ¨åˆ†æƒé™éœ€è¦ç®¡ç†å‘˜å®¡æ‰¹                     |
| **æ¶ˆæ¯å¡ç‰‡é™åˆ¶** | å¡ç‰‡ JSON æœ€å¤§ 30KBï¼Œéœ€è¦åˆ†ç‰‡å¤„ç†é•¿æ¶ˆæ¯    |
| **Token åˆ·æ–°**   | Access Token æœ‰æ•ˆæœŸ 2 å°æ—¶ï¼Œéœ€è¦è‡ªåŠ¨åˆ·æ–°   |
| **äº‹ä»¶è®¢é˜…**     | WebSocket æ¨¡å¼æ— éœ€å…¬ç½‘åœ°å€ï¼Œæ›´é€‚åˆæ¡Œé¢åº”ç”¨ |
| **@æåŠ**        | ç¾¤èŠä¸­éœ€è¦ @æœºå™¨äºº æ‰ä¼šæ”¶åˆ°æ¶ˆæ¯            |

---

## 10. å¼€å‘è®¡åˆ’

### Phase 1: åŸºç¡€è¿æ¥ (é¢„è®¡ 2-3 å¤©)

- [ ] åˆ›å»º LarkPlugin åŸºç±»
- [ ] å®ç° WebSocket äº‹ä»¶æ¥æ”¶
- [ ] å®ç° Access Token è‡ªåŠ¨åˆ·æ–°
- [ ] åŸºç¡€æ¶ˆæ¯æ”¶å‘åŠŸèƒ½

### Phase 2: å®‰å…¨è®¤è¯ (é¢„è®¡ 1-2 å¤©)

- [ ] å¤ç”¨ PairingService
- [ ] é…å¯¹æµç¨‹æ¶ˆæ¯å¡ç‰‡
- [ ] è®¾ç½®é¡µé¢ UI é€‚é…

### Phase 3: äº¤äº’å®Œå–„ (é¢„è®¡ 2-3 å¤©)

- [ ] æ¶ˆæ¯å¡ç‰‡æ¨¡æ¿ç³»ç»Ÿ
- [ ] æŒ‰é’®å›è°ƒå¤„ç†
- [ ] Agent åˆ‡æ¢åŠŸèƒ½
- [ ] æµå¼å“åº”æ”¯æŒ

### Phase 4: ä¼˜åŒ– (é¢„è®¡ 1-2 å¤©)

- [ ] é•¿æ¶ˆæ¯åˆ†ç‰‡å¤„ç†
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] å¤šè¯­è¨€æ”¯æŒ
- [ ] æ—¥å¿—ä¸ç›‘æ§

---

## 11. åŠŸèƒ½å¯¹é½æ¸…å•

| åŠŸèƒ½          | Telegram | é£ä¹¦ | å¤ç”¨ç»„ä»¶              |
| ------------- | :------: | :--: | --------------------- |
| Bot é…ç½®éªŒè¯  |    âœ…    |  ğŸ”²  | -                     |
| Bot å¯åŠ¨/åœæ­¢ |    âœ…    |  ğŸ”²  | ChannelManager        |
| é…å¯¹ç è®¤è¯    |    âœ…    |  ğŸ”²  | PairingService        |
| æœ¬åœ°æ‰¹å‡†æµç¨‹  |    âœ…    |  ğŸ”²  | ç°æœ‰ UI               |
| ç”¨æˆ·ç™½åå•    |    âœ…    |  ğŸ”²  | Database              |
| æŒ‰é’®äº¤äº’      |    âœ…    |  ğŸ”²  | SystemActions         |
| æµå¼å“åº”      |    âœ…    |  ğŸ”²  | ChannelMessageService |
| Agent åˆ‡æ¢    |    âœ…    |  ğŸ”²  | SystemActions         |
| æ–°å»ºä¼šè¯      |    âœ…    |  ğŸ”²  | SessionManager        |
| é€Ÿç‡é™åˆ¶      |    âœ…    |  ğŸ”²  | RateLimiter           |

---

## 12. éªŒæ”¶æ ‡å‡†

### 12.1 åŠŸèƒ½éªŒæ”¶

- [ ] é£ä¹¦åº”ç”¨å‡­è¯é…ç½®å’ŒéªŒè¯
- [ ] Bot å¯åŠ¨/åœæ­¢æ§åˆ¶
- [ ] é…å¯¹ç ç”Ÿæˆå’Œæœ¬åœ°æ‰¹å‡†æµç¨‹
- [ ] å·²æˆæƒç”¨æˆ·ç®¡ç†
- [ ] æ¶ˆæ¯å¡ç‰‡äº¤äº’
- [ ] ä¸ Gemini/Claude Agent å¯¹è¯
- [ ] Agent åˆ‡æ¢åŠŸèƒ½
- [ ] æ–°å»ºä¼šè¯åŠŸèƒ½
- [ ] æµå¼æ¶ˆæ¯å“åº”

### 12.2 å®‰å…¨éªŒæ”¶

- [ ] é…å¯¹ç  10 åˆ†é’Ÿè¿‡æœŸ
- [ ] å¿…é¡»åœ¨ AionUi æœ¬åœ°æ‰¹å‡†
- [ ] æœªæˆæƒç”¨æˆ·æ— æ³•ä½¿ç”¨
- [ ] App Secret åŠ å¯†å­˜å‚¨
- [ ] é€Ÿç‡é™åˆ¶ç”Ÿæ•ˆ

### 12.3 å…¼å®¹æ€§

- [ ] macOS æ­£å¸¸è¿è¡Œ
- [ ] Windows æ­£å¸¸è¿è¡Œ
- [ ] å¤šè¯­è¨€æ”¯æŒ

---

## æ¨¡æ¿ç»´æŠ¤

- **åˆ›å»ºæ—¥æœŸ**: 2026-01-30
- **æœ€åæ›´æ–°**: 2026-01-30
- **é€‚ç”¨ç‰ˆæœ¬**: AionUi v0.x+
- **ç»´æŠ¤è€…**: é¡¹ç›®å›¢é˜Ÿ
