openapi: 3.0.3
info:
  title: AionUI WebUI API
  version: 1.8.2
  description: |
    REST API for AionUI WebUI server providing authentication, conversation management,
    and AI agent interaction capabilities.

    ## Authentication
    AionUI supports two authentication methods:
    - **Local**: Username/password authentication with JWT tokens
    - **OIDC/SSO**: Enterprise single sign-on via EntraID (Azure AD) or other OIDC providers

    All protected endpoints require JWT authentication via:
    - Cookie: `aion_session` (access token, 15 min expiry)
    - Header: `Authorization: Bearer <token>`
    
    Refresh tokens (7 day expiry) are issued via httpOnly `aionui-refresh` cookie.
    Use `/api/auth/refresh` to rotate tokens without re-authentication.

    ## Authorization (RBAC)
    Users have one of three roles:
    - **admin**: Full system access including user management
    - **user**: Standard access to conversations and AI features
    - **viewer**: Read-only access

    ## User Scoping
    All `/api/*` routes support user data isolation:
    - `req.scopedUserId` determines whose data to access
    - Admins can override via `?userId=` query parameter
    - Regular users can only access their own data

    ## Rate Limiting
    - Login endpoints: 5 requests per minute
    - API endpoints: 100 requests per minute
    - File operations: 30 requests per minute
    - Authenticated actions: 30 requests per minute

  contact:
    name: Jason Matherly
    email: jason@matherly.net
  license:
    name: Apache-2.0
    url: https://www.apache.org/licenses/LICENSE-2.0

servers:
  - url: http://localhost:25808
    description: Local development server
  - url: https://{host}:{port}
    description: Production server
    variables:
      host:
        default: localhost
      port:
        default: "25808"

tags:
  - name: Authentication
    description: User authentication and session management
  - name: Admin - Users
    description: Administrative user management (requires admin role)
  - name: Admin - Global Models
    description: Admin global model management (requires admin role)
  - name: Admin - Logging
    description: Admin logging configuration (requires admin role)
  - name: Global Models
    description: User-facing global model endpoints (authenticated)
  - name: Knowledge Base
    description: Per-user LanceDB knowledge base / RAG (authenticated, user-scoped)
  - name: Python Environment
    description: Per-user Python environment management via mise (authenticated, user-scoped)
  - name: Directory
    description: File system directory operations (user-scoped)
  - name: Branding
    description: Application branding configuration
  - name: WebSocket
    description: Real-time communication endpoints

paths:
  # ===== Authentication =====
  /login:
    post:
      tags: [Authentication]
      summary: User login
      description: Authenticate user with username and password
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: Login successful
          headers:
            Set-Cookie:
              schema:
                type: string
              description: Session cookies (aion_session, aionui-refresh)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "429":
          $ref: "#/components/responses/TooManyRequests"
        "500":
          $ref: "#/components/responses/InternalError"

  /logout:
    post:
      tags: [Authentication]
      summary: User logout
      description: |
        Invalidate current session and clear cookies. Blacklists both the
        access token and refresh token, and revokes all refresh tokens for the user.
      operationId: logout
      security:
        - cookieAuth: []
        - bearerAuth: []
      responses:
        "200":
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Logged out successfully"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/auth/status:
    get:
      tags: [Authentication]
      summary: Get authentication status
      description: Check if system needs initial setup and OIDC availability
      operationId: getAuthStatus
      responses:
        "200":
          description: Authentication status
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthStatusResponse"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/auth/user:
    get:
      tags: [Authentication]
      summary: Get current user
      description: Retrieve current authenticated user information including display name, email, and avatar
      operationId: getCurrentUser
      security:
        - cookieAuth: []
        - bearerAuth: []
      responses:
        "200":
          description: User information
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/auth/change-password:
    post:
      tags: [Authentication]
      summary: Change password
      description: |
        Change the current user's password (local auth only).
        Invalidates all tokens and clears cookies â€” user must re-authenticate.
      operationId: changePassword
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChangePasswordRequest"
      responses:
        "200":
          description: Password changed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Password changed successfully. Please log in again."
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/auth/refresh:
    post:
      tags: [Authentication]
      summary: Refresh access token
      description: |
        Rotate refresh token and issue new access + refresh tokens.
        Uses httpOnly `aionui-refresh` cookie for authentication.
        Supports legacy fallback via body `token` field.
      operationId: refreshToken
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                refreshToken:
                  type: string
                  description: Refresh token (fallback if cookie not present)
                token:
                  type: string
                  description: Legacy access token refresh (deprecated)
      responses:
        "200":
          description: Tokens refreshed successfully
          headers:
            Set-Cookie:
              schema:
                type: string
              description: New httpOnly aionui-refresh cookie
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RefreshTokenResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/auth/oidc/login:
    get:
      tags: [Authentication]
      summary: Initiate OIDC login
      description: |
        Redirects to the configured OIDC identity provider (EntraID/Azure AD)
        for authentication. Available when OIDC is enabled.
      operationId: oidcLogin
      parameters:
        - name: redirect
          in: query
          schema:
            type: string
          description: URL to redirect to after successful authentication
      responses:
        "302":
          description: Redirect to identity provider
          headers:
            Location:
              schema:
                type: string
              description: OIDC authorization endpoint URL
        "404":
          description: OIDC not configured or not enabled

  /api/auth/oidc/callback:
    get:
      tags: [Authentication]
      summary: OIDC callback handler
      description: |
        Handles the callback from OIDC provider. Exchanges authorization code
        for tokens, performs JIT (just-in-time) user provisioning if needed,
        and establishes session.
      operationId: oidcCallback
      parameters:
        - name: code
          in: query
          required: true
          schema:
            type: string
          description: Authorization code from OIDC provider
        - name: state
          in: query
          required: true
          schema:
            type: string
          description: State parameter for CSRF protection
        - name: session_state
          in: query
          schema:
            type: string
          description: Optional session state from provider
      responses:
        "302":
          description: Redirect to application with session established
          headers:
            Location:
              schema:
                type: string
              description: Application URL (typically /)
            Set-Cookie:
              schema:
                type: string
              description: Session cookies (aion_session, aionui-refresh)
        "401":
          description: Authentication failed
          content:
            text/html:
              schema:
                type: string

  /api/auth/qr-login:
    post:
      tags: [Authentication]
      summary: QR code login
      description: Authenticate using QR code token (for mobile/desktop pairing)
      operationId: qrLogin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [qrToken]
              properties:
                qrToken:
                  type: string
                  description: QR token from scanned code
      responses:
        "200":
          description: QR login successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /qr-login:
    get:
      tags: [Authentication]
      summary: QR login page
      description: Static HTML page for QR code login flow
      operationId: qrLoginPage
      responses:
        "200":
          description: QR login HTML page
          content:
            text/html:
              schema:
                type: string

  # ===== Branding =====
  /api/branding:
    get:
      tags: [Branding]
      summary: Get branding configuration
      description: |
        Public endpoint (no auth required). Returns branding configuration
        from environment variables. Used by login page and pre-auth UI.
      operationId: getBranding
      responses:
        "200":
          description: Branding configuration
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BrandingConfig"
        "500":
          $ref: "#/components/responses/InternalError"

  # ===== WebSocket =====
  /api/ws-token:
    get:
      tags: [WebSocket]
      summary: Get WebSocket token
      description: Get token for WebSocket connection (reuses main session token)
      operationId: getWsToken
      security:
        - cookieAuth: []
        - bearerAuth: []
      responses:
        "200":
          description: WebSocket token
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  wsToken:
                    type: string
                  expiresIn:
                    type: integer
                    description: Token expiry in milliseconds
        "401":
          $ref: "#/components/responses/Unauthorized"

  # ===== Admin - Users =====
  /api/admin/users:
    get:
      tags: [Admin - Users]
      summary: List all users
      description: |
        Retrieve list of all users in the system. Password fields are sanitized.
        Requires admin role.
      operationId: listUsers
      security:
        - adminAuth: []
      responses:
        "200":
          description: List of users
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  users:
                    type: array
                    items:
                      $ref: "#/components/schemas/AdminUserResponse"
                  total:
                    type: integer
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/admin/users/{id}:
    get:
      tags: [Admin - Users]
      summary: Get user details
      description: Retrieve detailed information for a specific user. Requires admin role.
      operationId: getUser
      security:
        - adminAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: User ID
      responses:
        "200":
          description: User details
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  user:
                    $ref: "#/components/schemas/AdminUserResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          description: User not found

    delete:
      tags: [Admin - Users]
      summary: Deactivate user
      description: |
        Soft deactivate user by setting role to viewer. Cannot delete your own
        account. Requires admin role.
      operationId: deactivateUser
      security:
        - adminAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: User ID
      responses:
        "200":
          description: User deactivated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                    example: "User deactivated (role set to viewer)"
        "400":
          description: Cannot delete your own account
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          description: User not found

  /api/admin/users/{id}/role:
    patch:
      tags: [Admin - Users]
      summary: Update user role
      description: |
        Change a user's role. Includes self-demotion guard to prevent admins
        from demoting themselves. Requires admin role.
      operationId: updateUserRole
      security:
        - adminAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: User ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RoleUpdateRequest"
      responses:
        "200":
          description: Role updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                    example: "User role updated to user"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          description: User not found

  /api/admin/group-mappings:
    get:
      tags: [Admin - Users]
      summary: Get OIDC group mappings
      description: |
        View configured OIDC group to role mappings. Shows how groups from
        the identity provider map to AionUI roles. Requires admin role.
      operationId: getGroupMappings
      security:
        - adminAuth: []
      responses:
        "200":
          description: Group mappings
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  mappings:
                    type: array
                    items:
                      $ref: "#/components/schemas/GroupMapping"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  # ===== Admin - Global Models =====
  /api/admin/models:
    get:
      tags: [Admin - Global Models]
      summary: List all global models
      description: |
        List all global models with optional inclusion of disabled models.
        Returns API key hints (masked) for display. Requires admin role.
      operationId: adminListGlobalModels
      security:
        - adminAuth: []
      parameters:
        - name: includeDisabled
          in: query
          schema:
            type: string
            enum: ["true", "false"]
          description: Include disabled models (default false)
      responses:
        "200":
          description: List of global models
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  models:
                    type: array
                    items:
                      $ref: "#/components/schemas/GlobalModelAdmin"
                  total:
                    type: integer
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

    post:
      tags: [Admin - Global Models]
      summary: Create a global model
      description: |
        Create a new global model definition. API keys are encrypted at rest.
        Requires admin role.
      operationId: adminCreateGlobalModel
      security:
        - adminAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateGlobalModelRequest"
      responses:
        "201":
          description: Global model created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  model:
                    $ref: "#/components/schemas/GlobalModelAdmin"
        "400":
          description: Missing required fields (platform, name)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/admin/models/reorder:
    post:
      tags: [Admin - Global Models]
      summary: Reorder global models
      description: |
        Update priorities for all global models. Order array index determines
        priority (first = highest). Requires admin role.
      operationId: adminReorderGlobalModels
      security:
        - adminAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [order]
              properties:
                order:
                  type: array
                  items:
                    type: string
                  description: Array of model IDs in desired priority order (first = highest)
      responses:
        "200":
          description: Models reordered
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  models:
                    type: array
                    items:
                      $ref: "#/components/schemas/GlobalModel"
        "400":
          description: order must be an array of model IDs
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/admin/models/{id}:
    get:
      tags: [Admin - Global Models]
      summary: Get a global model
      description: Get details for a specific global model. Requires admin role.
      operationId: adminGetGlobalModel
      security:
        - adminAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Global model ID
      responses:
        "200":
          description: Global model details
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  model:
                    $ref: "#/components/schemas/GlobalModelAdmin"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          description: Global model not found

    patch:
      tags: [Admin - Global Models]
      summary: Update a global model
      description: |
        Partially update a global model. Only provided fields are updated.
        API key is only changed if a new value is provided. Requires admin role.
      operationId: adminUpdateGlobalModel
      security:
        - adminAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Global model ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateGlobalModelRequest"
      responses:
        "200":
          description: Global model updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  model:
                    $ref: "#/components/schemas/GlobalModelAdmin"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          description: Global model not found

    delete:
      tags: [Admin - Global Models]
      summary: Delete a global model
      description: Permanently delete a global model. Requires admin role.
      operationId: adminDeleteGlobalModel
      security:
        - adminAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Global model ID
      responses:
        "200":
          description: Global model deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                    example: "Global model deleted"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          description: Global model not found

  /api/admin/models/{id}/toggle:
    post:
      tags: [Admin - Global Models]
      summary: Enable or disable a global model
      description: Toggle the enabled state of a global model. Requires admin role.
      operationId: adminToggleGlobalModel
      security:
        - adminAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Global model ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [enabled]
              properties:
                enabled:
                  type: boolean
                  description: Whether the model should be enabled
      responses:
        "200":
          description: Model toggled
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  model:
                    $ref: "#/components/schemas/GlobalModelAdmin"
        "400":
          description: enabled must be a boolean
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          description: Global model not found

  # ===== Admin - Logging =====
  /api/admin/logging:
    get:
      tags: [Admin - Logging]
      summary: Get logging configuration
      description: |
        Get the current logging configuration including log level, format,
        destinations, OpenTelemetry, syslog, and Langfuse settings.
        Secret keys are masked in the response. Requires admin role.
      operationId: getLoggingConfig
      security:
        - adminAuth: []
      responses:
        "200":
          description: Logging configuration
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  config:
                    $ref: "#/components/schemas/LoggingConfig"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

    patch:
      tags: [Admin - Logging]
      summary: Update logging configuration
      description: |
        Update logging configuration. Only provided fields are changed.
        If log_level is changed, it takes effect immediately at runtime.
        Secret keys sent as '***' are ignored (not overwritten).
        Requires admin role.
      operationId: updateLoggingConfig
      security:
        - adminAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateLoggingConfigRequest"
      responses:
        "200":
          description: Configuration updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                    example: "Logging configuration updated"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/admin/logging/level:
    get:
      tags: [Admin - Logging]
      summary: Get current runtime log level
      description: Returns the current runtime log level. Requires admin role.
      operationId: getLogLevel
      security:
        - adminAuth: []
      responses:
        "200":
          description: Current log level
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  level:
                    type: string
                    enum: [trace, debug, info, warn, error, fatal, silent]
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

    post:
      tags: [Admin - Logging]
      summary: Change runtime log level
      description: |
        Change the log level at runtime without restarting the application.
        Requires admin role.
      operationId: setLogLevel
      security:
        - adminAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [level]
              properties:
                level:
                  type: string
                  enum: [trace, debug, info, warn, error, fatal, silent]
      responses:
        "200":
          description: Log level changed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  level:
                    type: string
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/admin/logging/test-syslog:
    post:
      tags: [Admin - Logging]
      summary: Test syslog connectivity
      description: |
        Send a test syslog message to verify connectivity. Supports UDP, TCP,
        and TLS protocols. For TLS, certificate verification can be disabled
        for self-signed/internal CA certs. Requires admin role.
      operationId: testSyslog
      security:
        - adminAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [host, port, protocol]
              properties:
                host:
                  type: string
                  description: Syslog server hostname
                  example: "localhost"
                port:
                  type: integer
                  description: Syslog server port
                  example: 514
                protocol:
                  type: string
                  enum: [udp, tcp, tls]
                  description: Transport protocol
                verifyCert:
                  type: boolean
                  description: Verify TLS certificate (default true, set false for self-signed)
                  default: true
      responses:
        "200":
          description: Syslog test successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                    example: "TCP syslog test successful (connection established)"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          description: Syslog test failed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  # ===== Global Models (User-facing) =====
  /api/models/global:
    get:
      tags: [Global Models]
      summary: Get visible global models
      description: |
        Returns global models that are enabled, not hidden by the current user,
        and accessible based on group membership. Filtered by allowed_groups
        and user role.
      operationId: getVisibleGlobalModels
      security:
        - cookieAuth: []
        - bearerAuth: []
      responses:
        "200":
          description: Visible global models
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  models:
                    type: array
                    items:
                      $ref: "#/components/schemas/GlobalModel"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/models/global/hidden:
    get:
      tags: [Global Models]
      summary: Get hidden global models
      description: |
        Returns global models that the current user has hidden. Only includes
        models the user would have access to based on group membership.
      operationId: getHiddenGlobalModels
      security:
        - cookieAuth: []
        - bearerAuth: []
      responses:
        "200":
          description: Hidden global models
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  models:
                    type: array
                    items:
                      $ref: "#/components/schemas/GlobalModel"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/models/global/{id}:
    get:
      tags: [Global Models]
      summary: Get global model details
      description: |
        Get a single global model's metadata for copy-to-local functionality.
        Does not return decrypted API key for security.
      operationId: getGlobalModelDetail
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Global model ID
      responses:
        "200":
          description: Global model details
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  model:
                    $ref: "#/components/schemas/GlobalModel"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          description: Global model not found

  /api/models/global/{id}/hide:
    post:
      tags: [Global Models]
      summary: Hide a global model
      description: Hide a global model from the current user's model list
      operationId: hideGlobalModel
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Global model ID
      responses:
        "200":
          description: Model hidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                    example: "Global model hidden"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          description: Global model not found

  /api/models/global/{id}/unhide:
    post:
      tags: [Global Models]
      summary: Unhide a global model
      description: Restore a previously hidden global model to the current user's model list
      operationId: unhideGlobalModel
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Global model ID
      responses:
        "200":
          description: Model unhidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                    example: "Global model unhidden"
        "401":
          $ref: "#/components/responses/Unauthorized"

  # ===== Knowledge Base =====
  /api/knowledge/status:
    get:
      tags: [Knowledge Base]
      summary: Get knowledge base status
      description: |
        Get the current user's knowledge base status including document count,
        chunk count, and storage usage. Backed by LanceDB.
      operationId: getKnowledgeStatus
      security:
        - cookieAuth: []
        - bearerAuth: []
      responses:
        "200":
          description: Knowledge base status
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  status:
                    type: object
                    description: Status object from lance manage.py stats
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/knowledge/documents:
    get:
      tags: [Knowledge Base]
      summary: List indexed documents
      description: List documents indexed in the knowledge base with pagination
      operationId: listKnowledgeDocuments
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 100
            minimum: 1
            maximum: 1000
          description: Maximum number of documents to return
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
            minimum: 0
          description: Offset for pagination
        - name: source
          in: query
          schema:
            type: string
          description: Filter by source file path
      responses:
        "200":
          description: Document list
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/knowledge/search:
    get:
      tags: [Knowledge Base]
      summary: Search knowledge base
      description: |
        Search the knowledge base using vector search, full-text search (FTS),
        or hybrid mode. Requires an OpenAI API key for vector embeddings.
      operationId: searchKnowledge
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
          description: Search query string
        - name: type
          in: query
          schema:
            type: string
            enum: [vector, fts, hybrid]
            default: hybrid
          description: Search type
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
          description: Maximum results to return
        - name: filter
          in: query
          schema:
            type: string
          description: SQL-like filter expression
      responses:
        "200":
          description: Search results
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        "400":
          description: Missing or invalid search query / invalid search type
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/knowledge/ingest:
    post:
      tags: [Knowledge Base]
      summary: Ingest a document
      description: |
        Ingest text content into the knowledge base. Content is chunked and
        embedded using OpenAI embeddings, then stored in LanceDB.
      operationId: ingestKnowledgeDocument
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/IngestDocumentRequest"
      responses:
        "200":
          description: Document ingested
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        "400":
          description: Missing source or text
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/knowledge/document/{source}:
    delete:
      tags: [Knowledge Base]
      summary: Delete a document
      description: Delete all chunks associated with a source document
      operationId: deleteKnowledgeDocument
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - name: source
          in: path
          required: true
          schema:
            type: string
          description: URL-encoded source file path
      responses:
        "200":
          description: Document deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        "400":
          description: Source file path required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/knowledge/reindex:
    post:
      tags: [Knowledge Base]
      summary: Rebuild indexes
      description: Rebuild all vector and FTS indexes for the knowledge base
      operationId: reindexKnowledge
      security:
        - cookieAuth: []
        - bearerAuth: []
      responses:
        "200":
          description: Reindex complete
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/knowledge/versions:
    get:
      tags: [Knowledge Base]
      summary: List version history
      description: List the version history of the knowledge base (LanceDB versioning)
      operationId: listKnowledgeVersions
      security:
        - cookieAuth: []
        - bearerAuth: []
      responses:
        "200":
          description: Version history
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/knowledge/restore:
    post:
      tags: [Knowledge Base]
      summary: Restore to a version
      description: Restore the knowledge base to a specific version number
      operationId: restoreKnowledgeVersion
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [version]
              properties:
                version:
                  type: integer
                  minimum: 1
                  description: Version number to restore to
      responses:
        "200":
          description: Version restored
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        "400":
          description: Valid version number required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/knowledge/clear:
    post:
      tags: [Knowledge Base]
      summary: Clear all knowledge base data
      description: |
        Delete all documents and chunks from the knowledge base.
        Requires explicit confirmation to prevent accidental deletion.
      operationId: clearKnowledge
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [confirm]
              properties:
                confirm:
                  type: boolean
                  description: Must be true to confirm deletion
                  example: true
      responses:
        "200":
          description: Knowledge base cleared
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        "400":
          description: Must confirm with { confirm: true }
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"

  # ===== Python Environment =====
  /api/python/status:
    get:
      tags: [Python Environment]
      summary: Get Python workspace status
      description: |
        Get the current user's Python environment status including whether
        mise is available, venv exists, Python version, and installed packages.
      operationId: getPythonStatus
      security:
        - cookieAuth: []
        - bearerAuth: []
      responses:
        "200":
          description: Python environment status
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  status:
                    $ref: "#/components/schemas/PythonStatus"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/python/packages:
    get:
      tags: [Python Environment]
      summary: List installed packages
      description: List all pip packages installed in the user's Python virtual environment
      operationId: listPythonPackages
      security:
        - cookieAuth: []
        - bearerAuth: []
      responses:
        "200":
          description: Package list
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  packages:
                    type: array
                    items:
                      $ref: "#/components/schemas/PythonPackage"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/python/version:
    get:
      tags: [Python Environment]
      summary: Get version info
      description: Get mise and Python version information for the current user
      operationId: getPythonVersion
      security:
        - cookieAuth: []
        - bearerAuth: []
      responses:
        "200":
          description: Version information
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  version:
                    type: object
                    properties:
                      mise:
                        type: string
                        nullable: true
                        description: mise version string
                      python:
                        type: string
                        nullable: true
                        description: Python version string
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/python/install:
    post:
      tags: [Python Environment]
      summary: Install a package
      description: |
        Install a pip package in the user's virtual environment.
        Supports version specifiers (e.g., `requests`, `anthropic>=0.39.0`).
      operationId: installPythonPackage
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [package]
              properties:
                package:
                  type: string
                  description: Package specifier (e.g., "requests", "anthropic>=0.39.0")
                  example: "requests"
      responses:
        "200":
          description: Package installed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                    example: "Installed requests"
        "400":
          description: Invalid package specification
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "503":
          description: mise is not available on this system
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/python/install-requirements:
    post:
      tags: [Python Environment]
      summary: Install from requirements.txt
      description: |
        Install packages from a requirements.txt file within the user's workspace.
        Path must be relative and cannot traverse directories.
      operationId: installPythonRequirements
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [path]
              properties:
                path:
                  type: string
                  description: Relative path to requirements.txt within workspace
                  example: "requirements.txt"
      responses:
        "200":
          description: Requirements installed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                    example: "Installed requirements from requirements.txt"
        "400":
          description: Invalid path (must be relative, no directory traversal)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "503":
          description: mise is not available on this system
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/python/reset:
    post:
      tags: [Python Environment]
      summary: Reset Python environment
      description: Delete and recreate the user's Python virtual environment
      operationId: resetPythonEnvironment
      security:
        - cookieAuth: []
        - bearerAuth: []
      responses:
        "200":
          description: Environment reset
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                    example: "Python environment reset successfully"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "503":
          description: mise is not available on this system
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  # ===== Directory =====
  /api/directory/browse:
    get:
      tags: [Directory]
      summary: Browse directory contents
      description: |
        List files and directories at specified path. Results are scoped
        to the user's workspace directory for security.
      operationId: browseDirectory
      security:
        - cookieAuth: []
        - bearerAuth: []
      parameters:
        - name: path
          in: query
          required: true
          schema:
            type: string
          description: Directory path to browse (relative to user workspace)
      responses:
        "200":
          description: Directory listing
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DirectoryListing"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          description: Directory not found

  /api/directory/validate:
    post:
      tags: [Directory]
      summary: Validate path
      description: Check if a path exists and is accessible within user's workspace
      operationId: validatePath
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [path]
              properties:
                path:
                  type: string
                  description: Path to validate
      responses:
        "200":
          description: Validation result
          content:
            application/json:
              schema:
                type: object
                properties:
                  valid:
                    type: boolean
                  exists:
                    type: boolean
                  isDirectory:
                    type: boolean
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/directory/shortcuts:
    get:
      tags: [Directory]
      summary: Get directory shortcuts
      description: Get common directory shortcuts (workspace, cache, etc.)
      operationId: getShortcuts
      security:
        - cookieAuth: []
        - bearerAuth: []
      responses:
        "200":
          description: Directory shortcuts
          content:
            application/json:
              schema:
                type: object
                properties:
                  workspace:
                    type: string
                  cache:
                    type: string
                  home:
                    type: string
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/directory/upload:
    post:
      tags: [Directory]
      summary: Upload file
      description: |
        Upload a file to the user's workspace. Files are sent as base64-encoded
        JSON (max 75MB request body, ~50MB file after encoding).
      operationId: uploadFile
      security:
        - cookieAuth: []
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [filename, content, targetPath]
              properties:
                filename:
                  type: string
                  description: Name of the file to create
                content:
                  type: string
                  format: byte
                  description: Base64-encoded file content
                targetPath:
                  type: string
                  description: Target directory path within workspace
      responses:
        "200":
          description: Upload successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  path:
                    type: string
                    description: Full path to uploaded file
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "413":
          description: Request entity too large (>75MB)

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT access token (15 min expiry)
    cookieAuth:
      type: apiKey
      in: cookie
      name: aion_session
      description: Session cookie containing JWT access token
    adminAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT access token with admin role required

  schemas:
    LoginRequest:
      type: object
      required: [username, password]
      properties:
        username:
          type: string
          minLength: 1
          example: admin
        password:
          type: string
          minLength: 8
          format: password

    LoginResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        user:
          $ref: "#/components/schemas/User"
        token:
          type: string
          description: JWT access token

    User:
      type: object
      properties:
        id:
          type: string
        username:
          type: string
        role:
          type: string
          enum: [admin, user, viewer]
          description: User's role determining access level
        authMethod:
          type: string
          enum: [local, oidc]
          description: Authentication method used
        displayName:
          type: string
          nullable: true
          description: User's display name (from OIDC or profile)
        email:
          type: string
          format: email
          nullable: true
          description: User's email address
        avatarUrl:
          type: string
          nullable: true
          description: URL to user's avatar image

    AuthStatusResponse:
      type: object
      properties:
        success:
          type: boolean
        needsSetup:
          type: boolean
          description: True if no users exist
        userCount:
          type: integer
        isAuthenticated:
          type: boolean
        oidcEnabled:
          type: boolean
          description: True if OIDC/SSO authentication is configured and ready

    UserResponse:
      type: object
      properties:
        success:
          type: boolean
        user:
          $ref: "#/components/schemas/User"

    AdminUserResponse:
      type: object
      description: User object with administrative fields (password sanitized)
      properties:
        id:
          type: string
        username:
          type: string
        role:
          type: string
          enum: [admin, user, viewer]
        authMethod:
          type: string
          enum: [local, oidc]
        displayName:
          type: string
          nullable: true
        email:
          type: string
          format: email
          nullable: true
        groups:
          type: array
          items:
            type: string
          description: OIDC groups (if applicable)
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
          nullable: true
        lastLogin:
          type: string
          format: date-time
          nullable: true

    RoleUpdateRequest:
      type: object
      required: [role]
      properties:
        role:
          type: string
          enum: [admin, user, viewer]
          description: New role to assign to user

    GroupMapping:
      type: object
      description: OIDC group to role mapping configuration
      properties:
        group:
          type: string
          description: OIDC group name or ID from identity provider
        role:
          type: string
          enum: [admin, user, viewer]
          description: AionUI role to assign to members of this group
        priority:
          type: integer
          description: Mapping priority (higher numbers take precedence)

    RefreshTokenResponse:
      type: object
      properties:
        success:
          type: boolean
        token:
          type: string
          description: New access token (also set in aion_session cookie)

    ChangePasswordRequest:
      type: object
      required: [currentPassword, newPassword]
      properties:
        currentPassword:
          type: string
          format: password
        newPassword:
          type: string
          format: password
          minLength: 8
          description: Must meet security requirements

    BrandingConfig:
      type: object
      description: Application branding configuration from environment variables
      properties:
        appName:
          type: string
          default: AionUi
          description: Application display name
        logoUrl:
          type: string
          nullable: true
          description: URL to custom logo image
        faviconUrl:
          type: string
          nullable: true
          description: URL to custom favicon

    GlobalModel:
      type: object
      description: Global model as seen by regular users (no API key)
      properties:
        id:
          type: string
        platform:
          type: string
          description: AI platform (e.g., openai, anthropic, google)
        name:
          type: string
          description: Display name for the model
        base_url:
          type: string
          description: API base URL
        models:
          type: array
          items:
            type: string
          description: List of model identifiers available
        capabilities:
          type: array
          items:
            type: string
          nullable: true
          description: Model capabilities (e.g., vision, function_calling)
        context_limit:
          type: integer
          nullable: true
          description: Maximum context window size
        custom_headers:
          type: object
          additionalProperties:
            type: string
          nullable: true
          description: Custom HTTP headers for API requests
        enabled:
          type: boolean
        priority:
          type: integer
          description: Display priority (higher = shown first)
        allowed_groups:
          type: array
          items:
            type: string
          nullable: true
          description: Groups with access (null = everyone)
        created_by:
          type: string
        created_at:
          type: integer
          description: Unix timestamp
        updated_at:
          type: integer
          description: Unix timestamp

    GlobalModelAdmin:
      allOf:
        - $ref: "#/components/schemas/GlobalModel"
        - type: object
          properties:
            apiKeyHint:
              type: string
              nullable: true
              description: Masked API key hint (e.g., "sk-...abc")

    CreateGlobalModelRequest:
      type: object
      required: [platform, name, models]
      properties:
        platform:
          type: string
          description: AI platform identifier
          example: "openai"
        name:
          type: string
          description: Display name
          example: "GPT-4o (Shared)"
        base_url:
          type: string
          description: API base URL
          example: "https://api.openai.com/v1"
        api_key:
          type: string
          description: API key (encrypted at rest)
        models:
          type: array
          items:
            type: string
          description: Available model identifiers
          example: ["gpt-4o", "gpt-4o-mini"]
        capabilities:
          type: array
          items:
            type: string
          description: Model capabilities
        context_limit:
          type: integer
          description: Max context window
        custom_headers:
          type: object
          additionalProperties:
            type: string
          description: Custom HTTP headers
        enabled:
          type: boolean
          default: true
        priority:
          type: integer
          default: 0
        allowed_groups:
          type: array
          items:
            type: string
          description: Restrict access to these groups (empty/null = everyone)

    UpdateGlobalModelRequest:
      type: object
      description: All fields optional â€” only provided fields are updated
      properties:
        platform:
          type: string
        name:
          type: string
        base_url:
          type: string
        api_key:
          type: string
          description: Only set if changing the API key
        models:
          type: array
          items:
            type: string
        capabilities:
          type: array
          items:
            type: string
        context_limit:
          type: integer
        custom_headers:
          type: object
          additionalProperties:
            type: string
        enabled:
          type: boolean
        priority:
          type: integer
        allowed_groups:
          type: array
          items:
            type: string
          nullable: true
          description: null or empty = everyone, array = restricted

    LoggingConfig:
      type: object
      description: Logging configuration (secret keys masked)
      properties:
        log_level:
          type: string
          enum: [trace, debug, info, warn, error, fatal, silent]
        log_format:
          type: string
          enum: [json, pretty]
        log_file:
          type: string
          nullable: true
        retention_days:
          type: integer
        max_size_mb:
          type: integer
        destinations:
          type: array
          items:
            type: string
            enum: [stdout, file]
        otel_enabled:
          type: boolean
        otel_endpoint:
          type: string
        otel_protocol:
          type: string
          enum: [http, grpc]
        otel_service_name:
          type: string
        otel_log_level:
          type: string
          enum: [debug, info, warn, error]
        syslog_enabled:
          type: boolean
        syslog_host:
          type: string
        syslog_port:
          type: integer
        syslog_protocol:
          type: string
          enum: [udp, tcp, tls]
        syslog_facility:
          type: integer
        langfuse_enabled:
          type: boolean
        langfuse_host:
          type: string
        langfuse_public_key:
          type: string
          description: Masked as '***' in responses
        langfuse_secret_key:
          type: string
          description: Masked as '***' in responses
        updated_by:
          type: string
        updated_at:
          type: integer
          description: Unix timestamp

    UpdateLoggingConfigRequest:
      type: object
      description: All fields optional â€” only provided fields are updated
      properties:
        log_level:
          type: string
          enum: [trace, debug, info, warn, error, fatal, silent]
        log_format:
          type: string
          enum: [json, pretty]
        log_file:
          type: string
          nullable: true
        retention_days:
          type: integer
        max_size_mb:
          type: integer
        destinations:
          type: array
          items:
            type: string
        otel_enabled:
          type: boolean
        otel_endpoint:
          type: string
        otel_protocol:
          type: string
        otel_service_name:
          type: string
        otel_log_level:
          type: string
          enum: [debug, info, warn, error]
        syslog_enabled:
          type: boolean
        syslog_host:
          type: string
        syslog_port:
          type: integer
        syslog_protocol:
          type: string
          enum: [udp, tcp, tls]
        syslog_facility:
          type: integer
        langfuse_enabled:
          type: boolean
        langfuse_host:
          type: string
        langfuse_public_key:
          type: string
          description: Send '***' to leave unchanged
        langfuse_secret_key:
          type: string
          description: Send '***' to leave unchanged

    IngestDocumentRequest:
      type: object
      required: [source, text]
      properties:
        source:
          type: string
          description: Source file path for tracking
          example: "/docs/readme.md"
        text:
          type: string
          description: Text content to ingest
        chunkSize:
          type: integer
          minimum: 100
          maximum: 2000
          default: 500
          description: Maximum words per chunk
        overlap:
          type: integer
          minimum: 0
          maximum: 500
          default: 100
          description: Word overlap between chunks

    PythonStatus:
      type: object
      properties:
        initialized:
          type: boolean
          description: Whether the Python environment has been initialized
        miseAvailable:
          type: boolean
          description: Whether mise is available on the system
        venvExists:
          type: boolean
          description: Whether the virtual environment exists
        message:
          type: string
          description: Human-readable status message

    PythonPackage:
      type: object
      properties:
        name:
          type: string
          description: Package name
        version:
          type: string
          description: Installed version
        specifier:
          type: string
          description: Version specifier (e.g., "==")

    DirectoryListing:
      type: object
      properties:
        success:
          type: boolean
        path:
          type: string
        items:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
              type:
                type: string
                enum: [file, directory]
              size:
                type: integer
              modified:
                type: string
                format: date-time

    Error:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
        message:
          type: string
        code:
          type: string

  responses:
    Unauthorized:
      description: Authentication required or invalid
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            success: false
            message: "Invalid username or password"

    Forbidden:
      description: Insufficient permissions (requires admin role)
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            success: false
            message: "Admin access required"

    BadRequest:
      description: Invalid request parameters
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

    TooManyRequests:
      description: Rate limit exceeded
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            success: false
            error: "Too many requests, please try again later"

    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            success: false
            message: "Internal server error"
